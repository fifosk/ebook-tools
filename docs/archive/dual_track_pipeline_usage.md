# Dual-Track Pipeline Usage (Legacy Sandbox)

This document describes the older dual-lane sandbox assets used by the
`DualLaneSandbox` demo component. The production pipeline now emits
chunk-level metadata under `storage/<job_id>/metadata/` with
`audioTracks.*` and `timingTracks.*` entries inside each
`chunk_XXXX.json` file.

If you want to validate modern timing output, use:

- `python scripts/validate_word_timing.py --job-dir storage/<job_id>/metadata`
- `python scripts/validate_alignment_quality.py --job-dir storage/<job_id>/metadata`

The demo component still exists for local experiments:

- `web/src/components/demo/DualLaneSandbox.tsx`

## Legacy output layout (demo only)

The sandbox expects prebuilt timing JSONs and audio assets under:

- `audio/`
- `timing/<lane>/<chunk>.timing.json`

## Legacy timing format reference

Use `modules.core.rendering.timing_schema` for serialization helpers and
`scripts/validate_word_timing.py` to sanity-check tracks. Both expect:

- sentences stored with `sid`, `start`, `end`, and `words[]`
- per-word timings already bucketed (default 10 ms)
- track duration roughly matching the last sentence

## Frontend demo wiring

`web/src/components/demo/DualLaneSandbox.tsx` exercises a dual-lane gating flow
with:

- `web/src/utils/buildSlides.ts` for slide/gate construction
- `web/src/player/SentenceGateController.ts` for gate timing + audio playback
- `web/src/stores/gateStore.ts` and `web/src/hooks/useDualLaneHighlighting.ts`
  for state & wiring

Feed the sandbox the paths generated by the legacy pipeline (e.g., via the
Vite dev server) to verify highlighting and per-lane gating before integrating
into the main player UI.

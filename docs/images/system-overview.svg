<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="770" viewBox="0 0 1200 770">
  <style>
    text { font-family: -apple-system, 'Segoe UI', Helvetica, Arial, sans-serif; fill: #1a1a1a; }
    .title { font-size: 20px; font-weight: 600; }
    .layer-label { font-size: 12px; font-weight: 600; fill: #374151; }
    .box-label { font-size: 11px; font-weight: 500; }
    .box-sub { font-size: 10px; fill: #555; }
    .small { font-size: 9px; fill: #666; }
    rect, .rr { rx: 6; ry: 6; }
  </style>
  <defs>
    <marker id="ah" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#4b5563" />
    </marker>
    <marker id="ah-dash" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#996185" />
    </marker>
  </defs>

  <!-- Title -->
  <text class="title" x="30" y="32">ebook-tools — System Overview</text>

  <!-- ===== CLIENT LAYER ===== -->
  <rect x="30" y="55" width="1140" height="65" fill="#f0f0ff" stroke="#c7d2fe" stroke-width="1.5" stroke-dasharray="5 3" rx="8" />
  <text class="layer-label" x="45" y="72">Clients</text>
  <rect x="100" y="75" width="110" height="35" fill="#e8e0f0" stroke="#9673a6" stroke-width="1.5" />
  <text class="box-label" x="120" y="96">Browser</text>
  <rect x="230" y="75" width="140" height="35" fill="#e8e0f0" stroke="#9673a6" stroke-width="1.5" />
  <text class="box-label" x="248" y="96">iOS (iPhone/iPad)</text>
  <rect x="390" y="75" width="120" height="35" fill="#e8e0f0" stroke="#9673a6" stroke-width="1.5" />
  <text class="box-label" x="407" y="96">tvOS (Apple TV)</text>
  <rect x="530" y="75" width="60" height="35" fill="#e8e0f0" stroke="#9673a6" stroke-width="1.5" />
  <text class="box-label" x="547" y="96">CLI</text>

  <!-- ===== SYNOLOGY ===== -->
  <rect x="920" y="60" width="190" height="55" fill="#f3e8ef" stroke="#996185" stroke-width="1.5" />
  <text class="box-label" x="940" y="82">Synology DSM</text>
  <text class="box-sub" x="940" y="100">Reverse Proxy (TLS :443)</text>

  <!-- Arrow: clients → synology -->
  <line x1="590" y1="92" x2="918" y2="87" stroke="#4b5563" stroke-width="1.5" marker-end="url(#ah)" />

  <!-- ===== DOCKER COMPOSE BOUNDARY ===== -->
  <rect x="30" y="145" width="870" height="585" fill="none" stroke="#4d4d4d" stroke-width="2" stroke-dasharray="8 4" rx="10" />
  <text class="layer-label" x="45" y="165" fill="#4d4d4d">Docker Compose</text>

  <!-- Arrow: synology → frontend -->
  <line x1="1015" y1="117" x2="430" y2="185" stroke="#4b5563" stroke-width="1.5" marker-end="url(#ah)" />
  <text class="small" x="700" y="148">HTTPS</text>

  <!-- ===== FRONTEND CONTAINER ===== -->
  <rect x="50" y="180" width="400" height="140" fill="#e8f5e0" stroke="#82b366" stroke-width="1.5" />
  <text class="layer-label" x="65" y="200" fill="#2d6a2d">Frontend Container (Nginx :5173)</text>
  <!-- SPA views -->
  <rect x="65" y="212" width="70" height="26" fill="#fff" stroke="#82b366" stroke-width="1" />
  <text class="small" x="77" y="229">Library</text>
  <rect x="145" y="212" width="80" height="26" fill="#fff" stroke="#82b366" stroke-width="1" />
  <text class="small" x="152" y="229">Narration</text>
  <rect x="235" y="212" width="70" height="26" fill="#fff" stroke="#82b366" stroke-width="1" />
  <text class="small" x="245" y="229">Job Board</text>
  <rect x="315" y="212" width="90" height="26" fill="#fff" stroke="#82b366" stroke-width="1" />
  <text class="small" x="323" y="229">Interactive</text>
  <rect x="65" y="248" width="70" height="26" fill="#fff" stroke="#82b366" stroke-width="1" />
  <text class="small" x="73" y="265">Subtitles</text>
  <rect x="145" y="248" width="80" height="26" fill="#fff" stroke="#82b366" stroke-width="1" />
  <text class="small" x="150" y="265">YT Dubbing</text>
  <rect x="235" y="248" width="70" height="26" fill="#fff" stroke="#82b366" stroke-width="1" />
  <text class="small" x="253" y="265">Admin</text>
  <rect x="315" y="248" width="90" height="26" fill="#fff" stroke="#82b366" stroke-width="1" />
  <text class="small" x="323" y="265">MyLinguist</text>
  <text class="small" x="65" y="298">React SPA  |  Vite  |  Zustand stores  |  SSE client</text>

  <!-- ===== BACKEND CONTAINER ===== -->
  <rect x="50" y="340" width="840" height="110" fill="#e0eef8" stroke="#6c8ebf" stroke-width="1.5" />
  <text class="layer-label" x="65" y="360" fill="#2d5986">Backend Container (FastAPI :8000)</text>
  <!-- Routes -->
  <rect x="65" y="370" width="75" height="25" fill="#fff" stroke="#6c8ebf" stroke-width="1" />
  <text class="small" x="74" y="387">/api/auth</text>
  <rect x="150" y="370" width="95" height="25" fill="#fff" stroke="#6c8ebf" stroke-width="1" />
  <text class="small" x="156" y="387">/api/pipelines</text>
  <rect x="255" y="370" width="80" height="25" fill="#fff" stroke="#6c8ebf" stroke-width="1" />
  <text class="small" x="264" y="387">/api/media</text>
  <rect x="345" y="370" width="90" height="25" fill="#fff" stroke="#6c8ebf" stroke-width="1" />
  <text class="small" x="351" y="387">/api/assistant</text>
  <rect x="445" y="370" width="80" height="25" fill="#fff" stroke="#6c8ebf" stroke-width="1" />
  <text class="small" x="453" y="387">/api/admin</text>
  <rect x="535" y="370" width="90" height="25" fill="#fff" stroke="#6c8ebf" stroke-width="1" />
  <text class="small" x="541" y="387">/api/subtitles</text>
  <rect x="635" y="370" width="90" height="25" fill="#fff" stroke="#6c8ebf" stroke-width="1" />
  <text class="small" x="643" y="387">SSE Streams</text>
  <rect x="735" y="370" width="75" height="25" fill="#fff" stroke="#6c8ebf" stroke-width="1" />
  <text class="small" x="748" y="387">/storage</text>
  <text class="small" x="65" y="425">JWT Auth Middleware  |  CORS  |  Config Manager  |  Observability</text>

  <!-- Arrow: frontend → backend (proxy) -->
  <line x1="250" y1="320" x2="250" y2="338" stroke="#6c8ebf" stroke-width="1.5" marker-end="url(#ah)" />
  <text class="small" x="260" y="334">proxy /api/, /pipelines/, /storage/</text>

  <!-- ===== PROCESSING LAYER ===== -->
  <rect x="50" y="475" width="500" height="90" fill="#fef9e7" stroke="#d6b656" stroke-width="1.5" />
  <text class="layer-label" x="65" y="495" fill="#8b6d1a">Processing Layer</text>
  <rect x="65" y="505" width="120" height="45" fill="#fff" stroke="#d6b656" stroke-width="1" />
  <text class="box-sub" x="77" y="522">Pipeline</text>
  <text class="box-sub" x="77" y="537">Orchestrator</text>
  <rect x="200" y="505" width="140" height="45" fill="#fff" stroke="#d6b656" stroke-width="1" />
  <text class="box-sub" x="215" y="522">Job Manager</text>
  <text class="box-sub" x="215" y="537">(state + persistence)</text>
  <rect x="355" y="505" width="140" height="45" fill="#fff" stroke="#d6b656" stroke-width="1" />
  <text class="box-sub" x="370" y="522">Worker Pool</text>
  <text class="box-sub" x="370" y="537">(parallel rendering)</text>

  <!-- Arrow: backend → processing -->
  <line x1="300" y1="452" x2="300" y2="473" stroke="#d6b656" stroke-width="1.5" marker-end="url(#ah)" />

  <!-- ===== STORAGE ===== -->
  <rect x="580" y="475" width="300" height="90" fill="#f5f5f5" stroke="#666" stroke-width="1.5" />
  <text class="layer-label" x="595" y="495" fill="#444">Storage</text>
  <rect x="595" y="505" width="120" height="45" fill="#fff" stroke="#666" stroke-width="1" />
  <text class="box-sub" x="607" y="522">storage/jobs/</text>
  <text class="box-sub" x="607" y="537">(metadata, audio, images)</text>
  <rect x="730" y="505" width="120" height="45" fill="#fff" stroke="#666" stroke-width="1" />
  <text class="box-sub" x="742" y="522">NAS Mounts</text>
  <text class="box-sub" x="742" y="537">(ebooks, videos, subs)</text>

  <!-- Arrow: processing → storage -->
  <line x1="552" y1="520" x2="578" y2="520" stroke="#666" stroke-width="1.5" marker-end="url(#ah)" />

  <!-- ===== SERVICE BACKENDS ===== -->
  <rect x="50" y="590" width="840" height="100" fill="#fde8e8" stroke="#b85450" stroke-width="1.5" />
  <text class="layer-label" x="65" y="610" fill="#8b3a36">Service Backends</text>
  <rect x="65" y="620" width="175" height="55" fill="#fff" stroke="#b85450" stroke-width="1" />
  <text class="box-sub" x="77" y="638">Translation Engine</text>
  <text class="small" x="77" y="654">Google Translate</text>
  <text class="small" x="77" y="666">+ Ollama LLM fallback</text>
  <rect x="255" y="620" width="170" height="55" fill="#fff" stroke="#b85450" stroke-width="1" />
  <text class="box-sub" x="267" y="638">TTS Engine</text>
  <text class="small" x="267" y="654">macOS say | gTTS | Piper</text>
  <rect x="440" y="620" width="130" height="55" fill="#fff" stroke="#b85450" stroke-width="1" />
  <text class="box-sub" x="452" y="638">WhisperX</text>
  <text class="small" x="452" y="654">Forced Alignment</text>
  <text class="small" x="452" y="666">(word-level timing)</text>
  <rect x="585" y="620" width="150" height="55" fill="#fff" stroke="#b85450" stroke-width="1" />
  <text class="box-sub" x="597" y="638">Image Generator</text>
  <text class="small" x="597" y="654">Draw Things /</text>
  <text class="small" x="597" y="666">Stable Diffusion</text>
  <rect x="750" y="620" width="110" height="55" fill="#fff" stroke="#b85450" stroke-width="1" />
  <text class="box-sub" x="762" y="638">Resume &amp;</text>
  <text class="box-sub" x="762" y="653">Bookmarks</text>

  <!-- Arrow: processing → services -->
  <line x1="300" y1="567" x2="300" y2="588" stroke="#b85450" stroke-width="1.5" marker-end="url(#ah)" />

  <!-- ===== EXTERNAL SERVICES ===== -->
  <rect x="930" y="340" width="200" height="55" fill="#f3e8ef" stroke="#996185" stroke-width="1.5" />
  <text class="box-label" x="950" y="362">Ollama / LM Studio</text>
  <text class="box-sub" x="950" y="380">(LLM endpoint)</text>
  <rect x="930" y="415" width="200" height="55" fill="#f3e8ef" stroke="#996185" stroke-width="1.5" />
  <text class="box-label" x="950" y="437">Draw Things</text>
  <text class="box-sub" x="950" y="455">(Stable Diffusion API)</text>

  <!-- Dashed arrows to external -->
  <line x1="892" y1="370" x2="928" y2="367" stroke="#996185" stroke-width="1.5" stroke-dasharray="5 3" marker-end="url(#ah-dash)" />
  <line x1="892" y1="390" x2="928" y2="440" stroke="#996185" stroke-width="1.5" stroke-dasharray="5 3" marker-end="url(#ah-dash)" />
</svg>
